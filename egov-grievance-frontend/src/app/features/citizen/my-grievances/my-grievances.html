<!-- src/app/features/citizen/my-grievances/my-grievances.component.html -->

<div class="my-grievances-container">
  <!-- Header Card -->
  <mat-card class="header-card">
    <mat-card-header>
      <div class="header-content">
        <div class="title-section">
          <mat-icon class="header-icon">list</mat-icon>
          <div class="title-text">
            <h2>My Grievances</h2>
            <p>Track and manage all your submitted grievances</p>
          </div>
        </div>
        <button
          mat-raised-button
          color="primary"
          routerLink="/citizen/lodge-grievance"
          class="lodge-btn"
        >
          <mat-icon>add_circle</mat-icon>
          Lodge New Grievance
        </button>
      </div>
    </mat-card-header>
  </mat-card>

  <!-- Loading State -->
  <app-loader *ngIf="loading" message="Loading grievances..."></app-loader>

  <!-- Content Card -->
  <mat-card *ngIf="!loading" class="content-card">
    <!-- Tabs for filtering -->
    <mat-tab-group
      (selectedIndexChange)="onTabChange($event)"
      [selectedIndex]="selectedTab"
      animationDuration="300ms"
    >
      <!-- Open Grievances Tab -->
      <mat-tab label="Open Grievances">
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">pending_actions</mat-icon>
          <span class="tab-label">Open</span>
          <mat-chip class="count-chip open-chip">{{ getOpenCount() }}</mat-chip>
        </ng-template>
      </mat-tab>

      <!-- Closed Grievances Tab -->
      <mat-tab label="Closed Grievances">
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">done_all</mat-icon>
          <span class="tab-label">Closed</span>
          <mat-chip class="count-chip closed-chip">{{ getClosedCount() }}</mat-chip>
        </ng-template>
      </mat-tab>

      <!-- Escalated Grievances Tab -->
      <mat-tab label="Escalated Grievances">
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">priority_high</mat-icon>
          <span class="tab-label">Escalated</span>
          <mat-chip class="count-chip escalated-chip">{{ getEscalatedCount() }}</mat-chip>
        </ng-template>
      </mat-tab>
    </mat-tab-group>

    <!-- Table Container -->
    <div class="table-container">
      <!-- Empty State -->
      <div *ngIf="dataSource.data.length === 0" class="no-data">
        <mat-icon>inbox</mat-icon>
        <h3>No grievances found</h3>
        <p>You don't have any grievances in this category yet.</p>
        <button mat-raised-button color="primary" routerLink="/citizen/lodge-grievance">
          <mat-icon>add_circle</mat-icon>
          Lodge Your First Grievance
        </button>
      </div>

      <!-- Grievances Table -->
      <table
        mat-table
        [dataSource]="dataSource"
        class="grievances-table"
        *ngIf="dataSource.data.length > 0"
      >
        <!-- Grievance Number Column -->
        <ng-container matColumnDef="grievanceNumber">
          <th mat-header-cell *matHeaderCellDef>Grievance #</th>
          <td mat-cell *matCellDef="let row">
            <div class="grievance-number-cell">
              <strong class="grievance-number">{{ row.grievanceNumber }}</strong>
              <mat-chip
                *ngIf="row.priority === 'HIGH' || row.priority === 'CRITICAL'"
                [class]="'priority-chip priority-' + row.priority.toLowerCase()"
              >
                {{ row.priority }}
              </mat-chip>
            </div>
          </td>
        </ng-container>

        <!-- Title Column -->
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef>Title</th>
          <td mat-cell *matCellDef="let row">
            <div class="title-cell">
              <span class="title-text">{{ row.title }}</span>
              <span class="department-text" *ngIf="row.departmentName">
                {{ row.departmentName }}
              </span>
            </div>
          </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let row">
            <app-status-badge [status]="row.status" [showIcon]="true"></app-status-badge>
          </td>
        </ng-container>

        <!-- Created Date Column -->
        <ng-container matColumnDef="createdAt">
          <th mat-header-cell *matHeaderCellDef>Submitted On</th>
          <td mat-cell *matCellDef="let row">
            <div class="date-cell">
              <mat-icon class="date-icon">calendar_today</mat-icon>
              <span>{{ row.createdAt | date : 'medium' }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let row">
            <button
              mat-icon-button
              color="primary"
              (click)="viewDetails(row.id)"
              matTooltip="View Details"
              class="action-btn"
            >
              <mat-icon>visibility</mat-icon>
            </button>
          </td>
        </ng-container>

        <!-- Table Rows -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns"
          class="table-row"
          [class.urgent-row]="row.priority === 'CRITICAL'"
          (click)="viewDetails(row.id)"
        ></tr>
      </table>

      <!-- Paginator -->
      <mat-paginator
        *ngIf="dataSource.data.length > 0"
        [pageSizeOptions]="[5, 10, 25, 50]"
        [pageSize]="10"
        showFirstLastButtons
        aria-label="Select page"
      >
      </mat-paginator>
    </div>
  </mat-card>

  <!-- Info Card -->
  <mat-card class="info-card">
    <mat-card-content>
      <div class="info-content">
        <mat-icon>info</mat-icon>
        <div class="info-text">
          <h4>Quick Tips</h4>
          <ul>
            <li>Click on any grievance to view full details and status history</li>
            <li>You can escalate a grievance if you're not satisfied with the resolution</li>
            <li>Provide feedback once your grievance is resolved</li>
            <li>Check your email for status update notifications</li>
          </ul>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
